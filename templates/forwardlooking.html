{% extends 'base.html' %}
{% import 'boxes.html' as boxes %}
{% block content %}
    <ul class="list-inline" style="padding: 1em">
        <li><a href="#h_table">Table</a></li>
        <li>|</li>
        <!--<li><a href="#h_summary">Summary</a></li>
        <li>|</li>-->
        <li><a href="#h_narrative">Narrative</a></li>
        <li>|</li>
        <li><a href="#h_assesment">Assessment</a></li>
        <li>|</li>
        <li><a href="#h_exceptions">Exceptions</a></li>
        <li>|</li>
        <li><a href="#h_comparison">Comparison with Global Partnership Indicator methodology</a></li>
        <li>|</li>
        <li><a href="#h_comment">Comment</a><li>
        <li>|</li>
        <li><a href="#h_pseudocode">Pseudocode</a></li>
    </ul>

    <div class="panel panel-default" id="h_table">
    <div class="panel-heading">
        <span class="pull-right"><a href="{{url('forwardlooking.csv')}}">(This table as CSV)</a></span>
        <h3 class="panel-title">Table of Forward Looking calculations</h3>
    </div>
    <table class="table table-striped" id="main_table">
        <thead>
            <tr>
                <td></td>
                {% for column_header in forwardlooking.column_headers %}
                <td colspan="3" style="border-left: 1px solid gray;">{{column_header}}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Publisher Name</td>
                {% for i in range(0,3) %}
                {% for year in forwardlooking.years %}
                <td{% if loop.first %} style="border-left: 1px solid gray;"{% endif %}>{{year}}</td>
                {% endfor %}
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in forwardlooking.table() %}
            <tr>
                <td><a href="publisher/{{publisher}}.html">{{row.publisher_title}}</a></td>

                {% for column in row.year_columns %}
                    {% for year in forwardlooking.years %}
                        <td{% if loop.first %} style="border-left: 1px solid gray;"{% endif %}>
                            {{column[year]}}
                        </td>
                    {% endfor %}
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>



    <div class="panel panel-default" id="h_narrative">
    <div class="panel-heading">
        <h3 class="panel-title">Narrative</h3>
    </div>
    <div class="panel-body">
        <p>Developing countries have, since 2008, been asking their development partners to provide forward-looking data which can be used for both planning and budget preparation. While aggregated country-level budgets have a certain political value it is activity-level data that is of greatest benefit, and which this dimension attempts to assess.</p>
        <p>The standard asks publishers to break down their total commitment to an activity into annual or quarterly budgets - i.e. the sum of the reported budgets matches the sum of commitments. It is stressed that these budget breakdowns are indicative and are in no way binding.</p>
        <p>This assessment counts the number of current activities for this and the next two years that contain budgets. It is based on a number of assumptions:</p>
        <ul>
        <li>For any given future year all current activities should contain a budget.</li>
        <li>Activities are deemed to be current in any given year if their end date is reported to be in this year or beyond (or if there is no end date)</li>
        <li>Counting the number of activities that contain budgets provides a fairer result that summing the value of these budgets. The proportion of a publisher's total commitment for a future year that has already been committed to existing projects may vary greatly. (i.e you may have earmarked an amount to spend in three-years time, but not yet agreed on how to spend it.)</li>
        <li>For publisher's reporting multiple hierarchical levels ONLY the lowest level is used in this calculation.</li>
        </ul>
    </div>
    </div>


    <div class="panel panel-default" id="h_assesment">
    <div class="panel-heading">
        <h3 class="panel-title">Assessment</h3>
    </div>
    <div class="panel-body">
        <p>No assessment is provided as the percentage of current activities containing budgets for this and the next two years. No attempt is currently being made to turn these into a descriptive summary (as, for example, "Frequency = "Monthly")</p>
    </div>
    </div>



    <div class="panel panel-default" id="h_exceptions">
    <div class="panel-heading">
        <h3 class="panel-title">Exceptions</h3>
    </div>
    <div class="panel-body">
        <p></p>
    </div>
    </div>



    <div class="panel panel-default" id="h_comparison">
    <div class="panel-heading">
        <h3 class="panel-title">Comparison with Global Partnership Indicator methodology</h3>
    </div>
    <div class="panel-body">
        <p>This methodology differs substantially from the GP Indicator in two ways.</p>
        <ul>
        <li><strong>All</strong></em> activities are assessed, NOT only those containing Country Programmable Aid. CPA is calculated by the Forward Spending Survey by excluding activities based on a complex filtering of purpose codes, finance types and aid types. Firstly is difficult to explain. Secondly the provision, or lack thereof, of forward looking data is not believed to be determined by CPA status. Thirdly, as a multi-stakeholder standard many publishers, in particular implementing agencies, do not necessarily report CRS-specific fields.</li>
        <li>As explained above the <em><strong>number of activities</strong></em> with budgets, NOT the value of budgets is counted.</li>
        </ul>
    </div>
    </div>




    <div class="panel panel-default" id="h_comment">
    <div class="panel-heading">
        <h3 class="panel-title">Comment</h3>
    </div>
    <div class="panel-body">
        <p>To comment on this methodology, please use <a href="http://support.iatistandard.org/entries/61004309-Forward-looking">this page on the support forum</a>.</p>
    </div>
    </div>



    <div class="panel panel-default" id="h_pseudocode">
    <div class="panel-heading">
        <h3 class="panel-title">Pseudocode</h3>
    </div>
    <div class="panel-body">

    <p>For the purpose of this calculation, each <code>iati-activity</code> XML block is an activity.</p>

    <p>To test whether an activity is current in a given year:</p>

<pre>
For each activity-date of type end-planned or end-actual
    date =
        Parse activity-date/@iso-date as an iso date ('yyyy-mm-dd...')
        If this does not work parse activity-date/text() as an iso date ('yyyy-mm-dd...')
        If neither work, continue
    If date year >= given year
        The activity is current
    Else continue
Otherwise the activity is not current
</pre>

    <p>To find the year for a budget:</p>

<pre>
start = 
    Parse period-start/@iso-date as an iso date ('yyyy-mm-dd...')
    If this does not work parse period-start/text() as an iso date ('yyyy-mm-dd...')
    Otherwise null
end =
    Parse period-start/@iso-date as an iso date ('yyyy-mm-dd...')
    If this does not work parse period-start/text() as an iso date ('yyyy-mm-dd...')
    Otherwise null

If start and end are both not null 
    If (end - start <= 370 days)
        If end month >= 7
            budget year = end year
        Else
            budget year = end year - 1
    Else ignore the budget
Else budget year is null
</pre>
    
    <p>To calculate the "Current activities" column, count each activity that is current (as described above).</p>
    <p>To calculate the "Activities with budgets" column, count the number of current activities that are:
        <ul>
        <li>current</li>
        <li>AND contain at least one budget budget with a budget year (as desribed above) that matches the year of the column</p>
        </ul>
    </p>

    </div>
    </div>
{% endblock %}

{% block tablesorteroptions %}{
    widgets: ['stickyHeaders'],
    textExtraction:{
        7: function(node,table,cellIndex) {
            if ($(node).text().indexOf('-') > 0) return '0';
            else return $(node).text();
        },
        8: function(node,table,cellIndex) {
            if ($(node).text().indexOf('-') > 0) return '0';
            else return $(node).text();
        },
        9: function(node,table,cellIndex) {
            if ($(node).text().indexOf('-') > 0) return '0';
            else return $(node).text();
        }
    }
}{% endblock %}
{% block tablesortertarget %}table#main_table{% endblock %}

