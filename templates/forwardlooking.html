{% extends 'base.html' %}
{% import 'boxes.html' as boxes %}
{% block content %}
    <table class="table table-striped">
        <thead>
            <tr>
                <td>2013 Spend</td>
                <td>Publisher Name</td>
                <td>2014 (%)</td>
                <td>2015 (%)</td>
                <td>2016 (%)</td>
                <td>2014</td>
                <td>2015</td>
                <td>2016</td>
            </tr>
        </thead>
        <tbody>
            {% for publisher_title,publisher in publishers_ordered_by_title %}
            {% set publisher_stats = get_publisher_stats(publisher) %}
            <tr>
                <td>
                    {% if publisher_stats.spend_currency_year and '2013' in publisher_stats.spend_currency_year %}
                    {% for k,v in publisher_stats.spend_currency_year['2013'].items() %}
                    {{v}} {{k}}</br>
                    {% endfor %}
                    {% endif %}
                </td>
                <td><a href="publisher/{{publisher}}.html">{{publisher_title}}</a></td>
                <td>
                    {% if publisher_stats.forwardlooking_currency_year and '2014' in publisher_stats.forwardlooking_currency_year %}
                    {% with keys=publisher_stats.forwardlooking_currency_year['2014'].keys() %}
                    {% if publisher_stats.spend_currency_year and '2013' in publisher_stats.spend_currency_year %}
                    {% if keys|count == 1 and keys == publisher_stats.spend_currency_year['2013'].keys() %}
                    {{(publisher_stats.forwardlooking_currency_year['2014'][keys[0]]/publisher_stats.spend_currency_year['2013'][keys[0]]*100) | round(1)}}
                    {% else %}
                    *
                    {% endif %}
                    {% endif %}
                    {% endwith %}
                    {% endif %}
                </td>
                <td>
                    {% if publisher_stats.forwardlooking_currency_year and '2015' in publisher_stats.forwardlooking_currency_year %}
                    {% with keys=publisher_stats.forwardlooking_currency_year['2015'].keys() %}
                    {% if publisher_stats.spend_currency_year and '2013' in publisher_stats.spend_currency_year %}
                    {% if keys|count == 1 and keys == publisher_stats.spend_currency_year['2013'].keys() %}
                    {{(publisher_stats.forwardlooking_currency_year['2015'][keys[0]]/publisher_stats.spend_currency_year['2013'][keys[0]]*100) | round(1)}}
                    {% else %}
                    *
                    {% endif %}
                    {% endif %}
                    {% endwith %}
                    {% endif %}
                </td>
                <td>
                    {% if publisher_stats.forwardlooking_currency_year and '2016' in publisher_stats.forwardlooking_currency_year %}
                    {% with keys=publisher_stats.forwardlooking_currency_year['2016'].keys() %}
                    {% if publisher_stats.spend_currency_year and '2013' in publisher_stats.spend_currency_year %}
                    {% if keys|count == 1 and keys == publisher_stats.spend_currency_year['2013'].keys() %}
                    {{(publisher_stats.forwardlooking_currency_year['2016'][keys[0]]/publisher_stats.spend_currency_year['2013'][keys[0]]*100) | round(1)}}
                    {% else %}
                    *
                    {% endif %}
                    {% endif %}
                    {% endwith %}
                    {% endif %}
                </td>
                <td>
                    {% if publisher_stats.forwardlooking_currency_year and '2014' in publisher_stats.forwardlooking_currency_year %}
                    {% for k,v in publisher_stats.forwardlooking_currency_year['2014'].items() %}
                    {{v}} {{k}}</br>
                    {% endfor %}
                    {% endif %}
                </td>
                <td>
                    {% if publisher_stats.forwardlooking_currency_year and '2015' in publisher_stats.forwardlooking_currency_year %}
                    {% for k,v in publisher_stats.forwardlooking_currency_year['2015'].items() %}
                    {{v}} {{k}}</br>
                    {% endfor %}
                    {% endif %}
                </td>
                <td>
                    {% if publisher_stats.forwardlooking_currency_year and '2016' in publisher_stats.forwardlooking_currency_year %}
                    {% for k,v in publisher_stats.forwardlooking_currency_year['2016'].items() %}
                    {{v}} {{k}}</br>
                    {% endfor %}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

{% endblock %}
